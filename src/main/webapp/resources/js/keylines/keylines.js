//
//     KeyLines v1.9.17-1607
//
//     Copyright © 2011-2012 Cambridge Intelligence Limited. 
//     All rights reserved.
//

var KeyLines=KeyLines||{};


(function(){function j(a){return a.lastIndexOf(i())}var a;typeof KeyLinesExports!="undefined"?a=exports:(this.KeyLines=this.KeyLines||{},a=this.KeyLines.Util={});var b=a.clone=function(a,c){if(a===null)return null;switch(typeof a){case"object":if(d(a)){var e=[];for(var f=0;f<a.length;f++)e.push(b(a[f],c));return e}if(a instanceof Date)return new Date(a.getTime());var g={};for(var h in a)if(!c||h.charAt(0)!=="_")g[h]=b(a[h],c);return g;case"boolean":case"string":case"number":return a}},c=a.isFunction=function(a){if(a){var b={}.toString.call(a);return b.slice(0,13)==="[object Funct"}return!1};a.isNormalObject=function(a){return typeof a=="object"&&!(a instanceof Date)&&!d(a)&&!g(a)};var d=a.isArray=function(a){return Object.prototype.toString.call(a)==="[object Array]"};a.invoke=function(a,b){a&&c(a)&&a(b)};var e=a.ensureArray=function(a){return d(a)?a:[a]},f=!0;a.timerFn=function(a,b){return function(){if(f){var c=(new Date).getTime(),d=a.apply(this,arguments),e=(new Date).getTime();return console.log("fn "+b+" = "+(e-c)+"ms"),d}return a.apply(this,arguments)}},a.defaults=function(a,c){var d=b(a)||{};for(var e in c)if(!d.hasOwnProperty(e)||g(d[e]))d[e]=c[e];return d};var g=a.isNullOrUndefined=function(a){return a===null?!0:typeof a=="undefined"?!0:!1},h=a.flattenMap=function(a){var b=[];for(var c in a)b.push(c+"");return b},i=a.idSep=function(){return"✄"},k=a.rawId=function(a){if(g(a))return null;var b=a+"",c=j(b);return c!==-1&&(b=b.substring(0,c)),b};a.subId=function(a){if(g(a))return null;var b=a+"",c=j(b);return c!==-1?b.substring(c+1):null},a.dictToArray=function(a){var b=[];for(var c in a)b.push({id:c,val:a[c]});return b},a.arrayToDict=function(a){var b={};for(var c=0;c<a.length;c++)b[a[c].id]=a[c].val;return b};var l=a.makeIdMap=function(a){var b={};a=e(a);for(var c=0;c<a.length;c++)b[k(a[c])]=1;return b},m=a.contains=function(a,b){return n(a,b)!==-1},n=a.indexOf=function(a,b){for(var c=0;c<a.length;c++)if(a[c]===b)return c;return-1},o=a.merge=function(a,b){if(a){for(var c in b)a[c]=b[c];return a}return b},p=a.ensureId=function(a){return k(a)}})();


(function(){var a;typeof KeyLinesExports!="undefined"?a=exports:(this.KeyLines=this.KeyLines||{},a=this.KeyLines.DateTime={});var b={longMonths:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],longDays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],ampm:["AM","PM"]},c=[31,28,31,30,31,30,31,31,30,31,30,31],d=a.units={milli:0,sec:1,min:2,hour:3,day:4,week:5,month:6,year:7},e=function(a,b){return b?a-a%b:0},f=a.clone=function(a){return new Date(a.getTime())},g=function(a){if(a<d.milli||d.year<a)throw"bad unit range"},h=function(a,b){return a===1&&i(b)?29:c[a]},i=function(a){return(new Date(a,1,29)).getMonth()===1},j=a.clear=function(a,b,c){g(b);var h=f(a);b>d.milli&&h.setMilliseconds(0),b>d.sec&&h.setSeconds(0),b>d.min&&h.setMinutes(0),b>d.hour&&h.setHours(0),b>=d.month&&h.setDate(1),b>=d.year&&h.setMonth(0);switch(b){case d.milli:h.setMilliseconds(e(h.getMilliseconds(),c));break;case d.sec:h.setSeconds(e(h.getSeconds(),c));break;case d.min:h.setMinutes(e(h.getMinutes(),c));break;case d.hour:h.setHours(e(h.getHours(),c));break;case d.day:h.setDate(1);break;case d.week:var i=h.getDay(),j=i<1?6:i-1;h.setTime(h.getTime()-j*24*60*60*1e3);break;case d.month:h.setMonth(e(h.getMonth(),c));break;case d.year:h.setFullYear(e(h.getFullYear(),c))}return h},k=a.add=function(a,b,c){g(b);var e=f(a);if(b>d.week)switch(b){case d.month:var l=e.getMonth()+c,m=l%12,n=Math.floor(l/12);m<0&&(m+=12);var o=e.getDate();o=Math.min(o,h(m,e.getFullYear()+n)),e.setDate(o),e.setMonth(m),n!==0&&(e=k(e,d.year,n));break;case d.year:if(e.getMonth()===1&&e.getDate()===29){var p=e.getFullYear()+c;i(p)||(e=k(e,d.day,-1))}e.setFullYear(e.getFullYear()+c)}else{var j=c;b>d.milli&&(j*=1e3),b>d.sec&&(j*=60),b>d.min&&(j*=60),b>d.hour&&(j*=24),b>d.day&&(j*=7),e.setTime(e.getTime()+j)}return e},l=function(a){var b=a+"";while(b.length<2)b="0"+b;return b},m=new RegExp("(f?f?f)|(s?s)|(m?m)|(h?h)|(H?H)|(t?t)|(d?d?d?d)|(M?M?M?M?M)|(Q?Q)|yyyy|yy","gm"),n={f:function(a){return Math.floor(a.getMilliseconds()/100)},ff:function(a){return l(Math.floor(a.getMilliseconds()/10))},fff:function(a){return l(Math.floor(a.getMilliseconds()))},s:function(a){return a.getSeconds()},ss:function(a){return l(a.getSeconds())},m:function(a){return a.getMinutes()},mm:function(a){return l(a.getMinutes())},h:function(a){return 1+a.getHours()%12},hh:function(a){return l(1+a.getHours()%12)},H:function(a){return a.getHours()},HH:function(a){return l(a.getHours())},t:function(a){return b.ampm[Math.floor(a.getHours()/12)][0]},tt:function(a){return b.ampm[Math.floor(a.getHours()/12)]},d:function(a){return a.getDate()},dd:function(a){return l(a.getDate())},ddd:function(a){return b.shortDays[a.getDay()]},dddd:function(a){return b.longDays[a.getDay()]},M:function(a){return a.getMonth()+1},MM:function(a){return l(a.getMonth()+1)},MMM:function(a){return b.shortMonths[a.getMonth()]},MMMM:function(a){return b.longMonths[a.getMonth()]},MMMMM:function(a){return b.shortMonths[a.getMonth()].substr(0,1)},Q:function(a){var b=a.getMonth(),c=Math.floor(b/3)+1;return"Q"+c},QQ:function(a){var b=a.getMonth(),c=Math.floor(b/6)+1;return"H"+c},yyyy:function(a){return a.getFullYear()},yy:function(a){return l(a.getFullYear()%100)}},o=a.format=function(a,b){return b.replace(m,function(b){return n[b](a)})},p="(?::)?",q="(?:-|$)",r="(?:T|$)",s=function(a,b){return a[b]?parseInt(a[b],10):undefined},t=function(a,b,c,d){var e=s(a,b);return u(e)?c>e||e>d?undefined:e:c},u=function(a){return typeof a!="undefined"},v=new RegExp("^(\\d{4})"+q+"(\\d{2})?"+q+"(\\d{2})?"+r+"(\\d{2})?"+p+"(\\d{2})?"+p+"(\\d{2})?"+"(?:Z)?"+"(\\+|-)?"+"(\\d{2})?"+p+"(\\d{2})?"+""),w=a.parseISO8601=function(a){var b=v.exec(a);if(b){var c=s(b,1),d=t(b,2,1,12),e=t(b,3,1,31),f=t(b,4,0,23),g=t(b,5,0,59),i=t(b,6,0,59),j=b[7]==="-"?-1:1,k=t(b,8,0,12),l=t(b,9,0,59);if(!(u(c)&&u(d)&&u(e)&&u(f)&&u(g)&&u(i)&&u(k)&&u(l)))return;if(e>h(d-1,c))return;var m=new Date(c,d-1,e,f,g,i),n=j*(k*60+l)*60*1e3;return m.setTime(m.getTime()-n),m}return}})();


(function(){function f(a,b,c,d){d||(d=!1),a.addEventListener?a.addEventListener(b,c,d):a.attachEvent("on"+b,c)}function h(a){return a.pageX?a.pageX:a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft}function i(a){return a.pageY?a.pageY:a.clientY+document.body.scrollTop+document.documentElement.scrollTop}function k(a){return document.addEventListener&&ba()&&document.hasOwnProperty("webkitIsFullScreen")&&a.offsetParent!==null&&a.offsetParent.nodeName==="BODY"?!1:!0}function l(a,b){var c=[];for(var d=0;d<a[b].length;d++){var e=g(a[b][d]);c.push({id:a[b][d].identifier,x:e.x,y:e.y})}return c}function m(a){return a.target?a.target:a.srcElement}function n(a){var c=m(a),d=c.id;d in b&&(b[d].canvas||a.button!==0&&(o(d,c,a.button,a),p(a)))}function o(a,c,d,e){var f=c.getStageWidth()/c.width,h=R(a);f/=h;var i=g(e);b[a].privateFlashClick(d),b[a].mousedown(d,i.x*f,i.y*f,e.ctrlKey,e.shiftKey)}function p(a){a.stopPropagation&&a.stopPropagation(),a.preventDefault?a.preventDefault():a.returnValue=!1,a.preventCapture&&a.preventCapture(),a.preventBubble&&a.preventBubble()}function q(){function a(a,b){var e=a.pointerId||0,f=g(a),h=[];switch(b){case"ADD":c[e]||(c[e]={id:e,x:f.x,y:f.y});break;case"DEL":c[e]&&(delete c[e],d--);break;case"MOVE":c[e]&&(c[e]={id:e,x:f.x,y:f.y})}for(var i in c)h.push(c[i]);return h}function h(a,b){var d=a.pointerId||0,e=g(a),f=[];switch(b){case"ADD":c[d]||(f=[{id:d,x:e.x,y:e.y}]);break;case"DEL":c[d]&&(f=[c[d]]);break;case"MOVE":c[d]&&(f=[{id:d,x:e.x,y:e.y}])}return f}function i(a){return a.pointerType===a.MSPOINTER_TYPE_TOUCH}function j(a){e[a]=new MSGesture,e[a].target=document.getElementById(a)}function k(){o=1,q=0}function r(a){var c=a.wheelDelta?a.wheelDelta:-a.detail,d=m(a),e=b[d.id];if(e){var f=g(a);e.mousewheel(c,f.x,f.y),p(a)}}f(window,"mousedown",n,!0),f(document,"contextmenu",function(a){if(m(a).id in b)return p(a),!1}),f(document,"dragover",function(a){if(a.target.id in b){var c=g(a);b[a.target.id].dragover(c.x,c.y)}}),"ontouchstart"in document.documentElement&&(f(document,"touchstart",function(a){a.target.id in b&&(b[a.target.id].touchstart(l(a,"targetTouches"),l(a,"changedTouches")),a.preventDefault())}),f(document,"touchmove",function(a){a.target.id in b&&b[a.target.id].touchmove(l(a,"targetTouches"),l(a,"changedTouches"))}),f(document,"touchend",function(a){a.target.id in b&&b[a.target.id].touchend(l(a,"targetTouches"),l(a,"changedTouches"))}),f(document,"touchcancel",function(a){a.target.id in b&&b[a.target.id].touchcancel(l(a,"targetTouches"),l(a,"changedTouches"))}),f(document,"gesturestart",function(a){a.target.id in b&&(b[a.target.id].gesturestart(),a.preventDefault())}),f(document,"gesturechange",function(a){a.target.id in b&&(b[a.target.id].gesturechange(a.scale,a.rotation),a.preventDefault())}),f(document,"gestureend",function(a){a.target.id in b&&(b[a.target.id].gestureend(a.scale,a.rotation),a.preventDefault())}));var o=1,q=0;navigator.msMaxTouchPoints&&(f(document,"MSPointerDown",function(c){if(c.target.id in b&&i(c)){e[c.target.id]||j(c.target.id),d++,e[c.target.id].addPointer(c.pointerId);var f=h(c,"ADD");b[c.target.id].touchstart(a(c,"ADD"),f),c.preventDefault()}}),f(document,"MSPointerMove",function(c){if(c.target.id in b&&i(c)){var d=h(c,"MOVE");b[c.target.id].touchmove(a(c,"MOVE"),d),c.preventDefault()}}),f(document,"MSPointerUp",function(c){if(c.target.id in b&&i(c)){var d=h(c,"DEL");b[c.target.id].touchend(a(c,"DEL"),d),c.preventDefault()}}),f(document,"MSPointerCancel",function(c){if(c.target.id in b&&i(c)){var d=h(c,"DEL");b[c.target.id].touchcancel(a(c,"DEL"),d),c.preventDefault()}}),f(document,"MSHoldVisual",function(a){a.preventDefault()}),f(document,"MSGestureStart",function(a){var c=a.gestureObject.target.id,e=d>1;c in b&&e&&(b[c].gesturestart(),a.preventDefault())}),f(document,"MSGestureChange",function(a){var c=a.gestureObject.target.id,e=d>1&&a.detail!==a.MSGESTURE_FLAG_INERTIA;c in b&&e&&(o*=a.scale,q+=a.rotation*180/Math.PI,b[c].gesturechange(o,q),a.preventDefault())}),f(document,"MSGestureEnd",function(a){var c=a.gestureObject.target.id;c in b&&(b[c].gestureend(o,q),k(),a.preventDefault())})),f(window,"mousedown",function(a){if(a.target.id in b&&b[a.target.id].canvas){var c=g(a);b[a.target.id].mousedown(a.button,c.x,c.y,a.ctrlKey,a.shiftKey)}}),f(window,"mouseup",function(a){if(a.target.id in b&&b[a.target.id].canvas){var c=g(a);b[a.target.id].mouseup(c.x,c.y,a.ctrlKey,a.shiftKey)}}),f(window,"mousemove",function(a){if(a.target.id in b&&b[a.target.id].canvas){var c=g(a);b[a.target.id].mousemove(c.x,c.y,a.ctrlKey,a.shiftKey)}}),f(window,"dblclick",function(a){if(a.target.id in b&&b[a.target.id].canvas){var c=g(a);b[a.target.id].dblclick(c.x,c.y,a.ctrlKey,a.shiftKey),a.preventDefault()}}),f(window,"mouseleave",function(a){if(a.target.id in b&&b[a.target.id].canvas){var c=g(a);b[a.target.id].mouseleave()}}),f(document,"mousewheel",r),f(document,"DOMMouseScroll",r),f(document,"keyup",function(a){for(var c in b)b[c].canvas&&b[c].keyup(a.keyCode)}),f(document,"keydown",function(a){var c=!1;for(var d in b)b[d].canvas&&(c=c||b[d].keydown(a.keyCode,a.ctrlKey,a.shiftKey));c&&a.preventDefault&&a.preventDefault()})}function r(a){a in b&&delete b[a]}function s(a){b[a].id=function(){return a}}function t(a){a in b||(b[a]={})}function v(b,c){u++;var d="sink"+u;return KeyLines[d]=function(){var d=[].slice.call(arguments);if(c){var e=[];for(var f=0;f<d.length;f++)e.push(a.arrayToDict(d[f]));d=e}return b.apply(this,d)},"KeyLines."+d}function w(b,c,d,e,f,g){var h;if(e.length>0){var i=e[e.length-1];a.isFunction(i)&&(h=v(i,g),e.pop())}var j=c[b](d,e,h,f,g);return g&&(j=a.arrayToDict(j)),j}function x(a){function e(a,b,c,e,f){b[c]=function(){var b=[].slice.call(arguments);return w(a,d,c,b,e,f)}}var c=b[a],d=document.getElementById(a);c.bind=function(a,b){var c=v(b);d.privateBind(c,a)};var f=d.privateGetMethodsWithCallbacks();for(var g=0;g<f.length;g++)e("callAnything",c,f[g]);var h={graph:{},combo:{}},i={graph:{degrees:!0,distances:!0,betweenness:!0,closeness:!0},combo:{}};for(var j in h){var k=d.privateNamespaceNames(j);for(var l=0;l<k.length;l++)e("callAnything",h[j],k[l],j,i[j][k[l]])}c.graph=function(){return h.graph},c.combo=function(){return h.combo}}function y(a){var b=document.getElementById(a),c=b.parentNode;return!c.addEventListener}function z(c){var d=b[c];d.layout=function(b,e,f){b||(b="standard");var g=d.viewOptions(),h=g.height>0?g.width/g.height:1;e=a.defaults(e,{fit:!0,animate:!0,tidy:!0,ratio:h,tightness:5}),y(c)&&(e.flash=!0);if(e.flash&&!d.canvas)d.directLayout(b,e,f);else{var i={trigger:function(a,b,c){d.trigger(a,b,c)}},j=d.layoutStructure(b,e);KeyLines.Layouts.layout(b,i,j,e,!1,function(a,b){d.finishLayout(a,b,f)})}}}function A(c){var d=b[c];d.arrange=function(b,c,e,f){b||(b="grid"),e=a.defaults(e,{fit:!1,animate:!0,tidy:!1,ratio:1});var g={trigger:function(a,b,c){d.trigger(a,b,c)}},h=d.layoutStructure(b,e);KeyLines.Layouts.arrange(b,g,c,h,e,function(a,b){d.finishLayout(a,b,f)})}}function B(c){var d=b[c];d.filter=function(b,c,e){c=a.defaults(c,{animate:!0,time:1e3,hideSingletons:!1});var f={};d.each({type:"all"},function(a){b(a)&&(f[a.id]=!0)});if(c.hideSingletons){var g={};d.each({type:"link"},function(a){g[a.id1]|=f[a.id]&&f[a.id2],g[a.id2]|=f[a.id]&&f[a.id1]}),d.each({type:"node"},function(a){f[a.id]&=g[a.id]})}var h=[],i=[];d.each({type:"all"},function(a){f[a.id]&&a.hi&&h.push(a.id),!f[a.id]&&!a.hi&&i.push(a.id)}),i.length>0?h.length>0?(c.time/=2,d.hide(i,c,function(){d.show(h,!1,c,e)})):d.hide(i,c,e):h.length>0?d.show(h,!1,c,e):a.invoke(e)}}function C(c){var d=b[c];d.foreground=function(b,c,e){function f(a,b,c){a[b]||(a[b]={all:0,bg:0}),a[b].all++,a[b].bg+=c?1:0}c=a.defaults(c,{type:"node"});var g={};d.each(c,function(a){b(a)&&(g[a.id]=!0)});var h={};if(c.type==="link"){d.each({type:"link"},function(a){f(h,a.id1,!g[a.id]),f(h,a.id2,!g[a.id])});for(var i in h)!h[i].all&&!(h[i].all-h[i].bg)&&(g[i]=!1)}c.type==="node"&&d.each({type:"link"},function(a){g[a.id]=!!g[a.id1]&&!!g[a.id2]});var j=[];d.each({type:"all"},function(a){!!a.bg!=!g[a.id]&&j.push({id:a.id,bg:!g[a.id]})}),d.setProperties(j,!1,e)}}function D(c){var d=b[c];d.createLink=function(b,c,e,f){function k(b,e,g,i){var j=!e||KeyLines.Util.rawId(e)===c,l=d.getItem(e)&&!j?e:null;j&&b==="dummy"&&h&&d.removeItem([c,h]),d.unbind("dragcomplete",k),a.invoke(f,l)}var g=d.getItem(b);if(!b||!g||g.type!=="node")return;if(!c)return;c=a.ensureId(c),e=a.defaults(e,{style:{}}),d.bind("dragcomplete",k);var h="dummyEnd"+Math.floor(Math.random()*1e7),i={type:"node",du:!0,id:h,x:g.x,y:g.y},j={id:c,id2:h,id1:b,type:"link"};j=KeyLines.Util.merge(e.style,j),d.merge([i,j],function(){setTimeout(function(){d.startDragger(c,h+a.idSep()+"id2",g.x,g.y)},50)})}}function E(c){var d=b[c];d.expand=function(b,c,e){function f(a,b,c){var e,f,g,h,i,j,k,l=[],m=[];while(a.length){k=a.pop();var n=d.getItem(k.id);if(k.type==="node"&&!b[k.id]&&n){m.push(k.id),f=d.graph().neighbours(k.id),h=i=j=0;for(var o=0;o<f.nodes.length;o++)g=f.nodes[o],b[g]&&(j++,h+=b[g].x,i+=b[g].y);l.push({id:k.id,x:j?h/j:h,y:j?i/j:i})}}d.setProperties(l,!1,c)}function g(){var a=[],b={};return d.each({type:"node"},function(c){a.push(c.id);if(d.combo().isCombo(c.id)){var e=d.combo().info(c.id).nodes;KeyLines.Util.merge(b,KeyLines.Util.makeIdMap(e))}b[c.id]=c}),{list:a,dict:b}}function h(a,b){var c=[],d={};for(var e=0;e<a.length;e++)!d[a[e].id]&&!KeyLines.Util.isNullOrUndefined(a[e])&&(d[a[e].id]=1,delete a[e].x,delete a[e].y,c.push(a[e]));return c}function i(){var a={fixed:l,animate:!!c.animate,ms:c.time,tightness:c.tightness,tidy:c.tidy,fit:c.fit,strategy:"spiral"},b=d.layoutStructure("standard",a);KeyLines.Layouts.layout("standard",j,b,a,!1,function(a,b){d.finishLayout(a,b,e)})}c=a.defaults(c,{fit:!1,tidy:!1,animate:!0,tightness:5,time:1e3});var j={trigger:function(a,b,c){d.trigger(a,b,c)}};b=KeyLines.Util.ensureArray(b),j.trigger("prechange","expand");var k=g(),l=k.list,m=k.dict;b=h(b,m),d.merge(b,function(){f(b,m,i)})}}function F(a,b){return function(){var c=document.getElementById(a);switch(arguments.length){case 0:return c[b]();case 1:return c[b](arguments[0]);case 2:return c[b](arguments[0],arguments[1]);case 3:return c[b](arguments[0],arguments[1],arguments[2]);case 4:return c[b](arguments[0],arguments[1],arguments[2],arguments[3]);case 5:return c[b](arguments[0],arguments[1],arguments[2],arguments[3],arguments[4])}}}function M(){return typeof KeyLines.Canvas!="undefined"}function N(a){P(a),A(a),E(a),D(a),B(a),C(a)}function Q(a,b){return a==="all"||a===b.type}function R(a){var b=document.getElementById(a);if(b)return b.clientWidth/Number(b.width)}function S(a){var b=document.getElementById(a),c=b.parentNode;c.addEventListener||(f(c,"mousedown",function(d){if(d.button>1){c.setCapture();var e=d.button<4?2:1;o(a,b,e,d)}},!0),f(c,"mouseup",function(a){c.releaseCapture()},!0))}function T(a){bg(a),U[a]&&V[a]&&(U[a]=!1,V[a]=!1,S(a),N(a),W[a]&&W[a](null,b[a]))}function X(a){var b=document.getElementsByTagName("head")[0],c=document.createElement("script");c.type="text/javascript",c.src=Y,c.onreadystatechange=a,c.onload=a,b.appendChild(c)}function ba(){return document.hasOwnProperty("webkitIsFullScreen")?document.webkitIsFullScreen:typeof document.mozFullScreen!="undefined"?document.mozFullScreen:document.fullScreenElement&&document.fullScreenElement!==null}function bb(a){if(document.hasOwnProperty("webkitCurrentFullScreenElement"))return document.webkitCurrentFullScreenElement===a;if(typeof document.mozFullScreenElement!="undefined")return document.mozFullScreenElement===a}function bc(){return typeof document.mozFullScreen!="undefined"}function be(){bc()&&bf()}function bf(){}function bg(a){}function bh(a){a.requestFullScreen?a.requestFullScreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullScreen&&a.webkitRequestFullScreen()}function bi(a){bj&&bj(ba())}var a=typeof KeyLinesRequire!="undefined"?require("./util"):this.KeyLines.Util,b=KeyLines.charts={},c={},d=0,e={};q();var g=KeyLines.coords=function(a){var b=j(m(a).id),c=Math.floor(h(a)-b.left),d=Math.floor(i(a)-b.top);return{x:c,y:d}},j=KeyLines.getOffset=function(a){var b=document.getElementById(a),c=0,d=0;do k(b)&&(c+=b.offsetLeft,d+=b.offsetTop),b=b.offsetParent;while(b);return{left:c,top:d}};KeyLines.initializeFlashBroker=function(a){t(a);var c=b[a];for(var d in c)c[d]=F(a,d);s(a),x(a),z(a),c.canvas=!1,c.ready=!0};var u=0;KeyLines.addFlashFunction=function(a,c){t(a),b[a][c]={}};var G="auto",H=KeyLines.mode=function(a){return a&&(G=a),G};KeyLines.createChart=function(){var a,b,c,d;switch(arguments.length){case 0:throw"createChart called with zero arguments";case 1:case 2:a=arguments[0],d=arguments[1];var e=document.getElementById(a);b=e.clientWidth,c=e.clientHeight;break;default:a=arguments[0],b=arguments[1],c=arguments[2],d=arguments[3]}b||(b=100),c||(c=100);var f=G!=="flash";if(f&&L()&&M())O(a,b,c,d);else{if(G==="canvas"){var g="Could not create HTML5 canvas. Try using auto or flash mode.";d(g);return}_(a,b,c,d)}};var I,J=KeyLines.setCanvasPaths=function(a){I=a},K;KeyLines.imageBasePath=function(a){return a&&(K=a),K},J("assets/");var L=KeyLines.html5CanvasSupport=function(){var a=document.createElement("canvas");return!!a.getContext&&!!a.getContext("2d")},O=function(a,c,d,e){r(a),t(a);var f=document.getElementById(a);b[a]=KeyLines.Canvas.create(a,c,d,I,K),s(a),z(a),N(a),e&&e(null,b[a])},P=function(c){b[c].each=function(d,e){var f=b[c].serialize().items;d=a.defaults(d,{type:"all"});if(!d.type.match(/^(node|link|all)$/))throw new TypeError("opts type property should be either 'node', 'link' or 'all'");if(a.isFunction(e))for(var g=0;g<f.length;g++)Q(d.type,f[g])&&e(f[g])}};KeyLines.flashInitialized=function(a){V[a]=!0,T(a)},KeyLines.setSize=function(a,c,d){if(c<=0||d<=0)return;var e=document.getElementById(a);e&&(e.style.height=d+"px",e.style.width=c+"px",b[a]&&b[a].canvas&&b[a].setSize(c,d,1))},KeyLines.getElementWidth=function(a){var b=document.getElementById(a);if(b)return b.clientWidth};var U={},V={},W={},Y,Z,$;KeyLines.setFlashPaths=function(a,b,c){Z=a,Y=b,$=c};var _=function(a,b,c,d){r(a),W[a]=d,U[a]=!1,V[a]=!1,X(function(){var e={identifier:a},f={menu:"false",quality:"best",wmode:"opaque",allowScriptAccess:"always",allowNetworking:"all"},g={};typeof swfobject!="undefined"&&(U[a]||swfobject.embedSWF(Z,a,b,c,"10.0.0",$,e,f,g,function(b){b.success?(U[a]=!0,T(a)):d("swfobject embedSWF returned error "+b)}))})};document.addEventListener&&(document.addEventListener("fullscreenchange",bi,!1),document.addEventListener("mozfullscreenchange",bi,!1),document.addEventListener("webkitfullscreenchange",bi,!1));var bd={};KeyLines.fullScreenCapable=function(){return document.addEventListener?document.hasOwnProperty("webkitCurrentFullScreenElement")?!0:typeof document.mozFullScreenElement!="undefined"?!0:!1:!1};var bj;KeyLines.toggleFullScreen=function(a,b){if(!document.addEventListener)return;be(),bj=b,ba()?bb(a)?document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():bh(a):bh(a)}})();


(function(){function c(a,b,c,d,e,f){d?a[b]=c[b]:a[b]={x:e,y:f}}function d(a,b,d,g,h){var i=1.25-(H(d.tightness)-5)/10,j=f(b.v,b.e),k=e(j,b.v,i);S(a,k,d,g,function(a,d,e){var f={};for(var g in a.vertices)if(j.rev[g]){var i=a.vertices[g].fixed;for(var k=0;k<j.rev[g].length;k++){var l=j.rev[g][k],m=a.vertices[g].x+a.vertices[g].jit.positions[l].x,n=a.vertices[g].y+a.vertices[g].jit.positions[l].y;c(f,l,b.v,i,m,n)}}else c(f,g,b.v,b.v[g].fixed,a.vertices[g].x,a.vertices[g].y);var o={vertices:f,extents:a.extents};h(o,d,e)})}function e(a,b,c){var d={},e=[],f=0;for(var g in a.rev){var h={};h.x=h.y=h.size=0;var i=a.rev[g].length,j=!1;for(var l=0;l<i;l++){var m=b[a.rev[g][l]];h.x+=m.x,h.y+=m.y,h.size+=m.size}h.x=h.x/i,h.y=h.y/i;var n=k(b,a.rev[g],h.size/i,c);d[g]={x:h.x,y:h.y,size:n.radius,fixed:j,jit:n,lc:0},f++;var o=a.rev[g][0],p={},q=a.index[o];for(var r=0;r<q.length;r++){var s=q[r];p[a.ids[s]]=1}for(var t in p)g<t&&e.push({id1:g,id2:t})}for(var u=0;u<e.length;u++)d[e[u].id1].lc++,d[e[u].id2].lc++;for(var v in b)if(!a.ids[v]){var w=b[v];d[v]={x:w.x,y:w.y,size:w.size,lc:0,fixed:w.fixed,jit:{radius:w.size,position:{x:0,y:0}}},f++}return{v:d,e:e,vcount:f,extents:A(d)}}function f(a,b){var c=i(b);return j(c)}function g(a,b,c){a[c]||(a[c]=[]),a[c].push(b)}function h(a,b){g(a,b.id1,b.id2),g(a,b.id2,b.id1)}function i(a){var b={};for(var c=0;c<a.length;c++)h(b,a[c]);return b}function j(a){var b={},c={},d;for(var e in a){a[e].sort(),d="";for(var f=0;f<a[e].length;f++)d+=a[e][f];b[d]||(b[d]=[]),b[d].push(e),c[e]=d}return{rev:b,ids:c,index:a}}function k(a,b,c,d){var e={},f=0,g,h=b.length-1;do g=l(a,b,c,h,e,d),f=Math.max(g.radius,f),h=g.index;while(h>=0);var i;switch(b.length){case 4:i=2;break;case 3:i=2.5;break;case 2:i=3;break;case 1:i=1;break;default:i=2}return{positions:e,radius:f*i}}function l(a,b,c,d,e,f){if(d===0)return e[b[0]]={x:0,y:0},{radius:c,index:-1};var g=(d+1)*c,h=c,i=Math.sqrt(g/(Math.PI*h)),j=i*h,k=Math.floor(2*Math.PI*j/c);k=Math.min(k,d+1);var l=Math.PI*2/k,m=0;switch(k){case 2:m=Math.PI/2,j*=.75;break;case 3:m=Math.PI/3,j*=.85;break;case 4:m=0,j*=.85;break;case 5:m=0,j*=.9;break;default:m=0}j*=f;var n=0;while(n<k)e[b[d-n]]={x:j*Math.cos(m),y:j*Math.sin(m)},m+=l,n++;return d-=k,{radius:j,index:d}}function m(a,b,c,d){var e=0,f={},g;for(g=0;g<b.length;g++)e+=a[b[g]].size;if(b.length===1)f[b[0]]={x:0,y:0};else{var h=Math.PI/4;b.length===2&&(h=Math.PI/2),b.length===4&&(h=0),b.length<4&&(e*=1.5);var i=Math.PI*2/b.length,j=d*e/4;for(g=0;g<b.length;g++)f[b[g]]={x:j*Math.cos(h),y:j*Math.sin(h)},h+=i}return{positions:f,radius:e}}function q(a,b){function c(a,b){return e(a.link)-e(b.link)}function e(a){var b=bb(a.off)?a.off:d;return a.id1>=a.id2&&(b=-b),b}function f(a,b){a.id1<a.id2?a.off=b:a.off=-b}var d=1e6,g;for(var h in b)g=a[h],g.sort(c);for(h in b){g=a[h];var i=Math.floor(g.length/2),j=(g.length+1)%2/2;for(var k=0;k<g.length;k++)f(g[k].link,(k-i+j)*n)}}function s(a,b,c,d){if(a.w&&a.h)return C(a.w,a.h);if(a.du)return 10;var e=26,f=e*(a.e?a.e:1),g=c.nodeTextWidth(a,b);if(d){var h=f+g.height/2,i=g.width/2;return C(i,h)}return f+g.height/2}function t(a,b,c,d,e,f,g,h,i){var j=e[g];if(!(j in c)){if(!(j in d))throw"link has end which is not in nodes list";var k=d[j];if(k.hi)throw"link has end which is hidden";c[j]=u(a,b,k,j,h,i)}return j}function u(a,b,c,d,e,f){return{x:c.x,y:c.y,size:s(c,b,a,f),fixed:e?d in e:!1,lc:0}}function v(a,b,c,d,e,f){var g=r(d),h={},i=[];for(var j=0;j<g.length;j++){var k=g[j][0].link,l=g[j][0].id,m=t(a,b,h,c,k,l,"id1",e,f),n=t(a,b,h,c,k,l,"id2",e,f);m!==null&&n!==null&&(i.push({id1:m,id2:n,id:l}),h[m].lc+=1,h[n].lc+=1)}for(var o in c)if(!c[o].hi&&!h[o]){var p=u(a,b,c[o],o,e,f);h[o]=p}var q=0;for(o in h)q++;return{v:h,e:i,vcount:q}}function w(a,b){var c=0,d=[],e;for(var f in a)if(!a[f].hasOwnProperty("c")){var g=c++;d.push(f+"");while(d.length>0){var h=d.shift();if(!a[h].hasOwnProperty("c")){a[h].c=g;for(e=0;e<b.length;e++)b[e].id1===h&&(b[e].c=g,d.push(b[e].id2)),b[e].id2===h&&(b[e].c=g,d.push(b[e].id1))}}}var i=new Array(c);for(var j=0;j<i.length;j++)i[j]={verts:{},edges:[]};for(f in a)i[a[f].c].verts[f]=a[f];for(e=0;e<b.length;e++)i[b[e].c].edges.push(b[e]);for(var k=0;k<i.length;k++)i[k].extents=A(i[k].verts);return i}function y(a){var b=[];for(var c in a.v)b.push({id:c,v:a.v[c]});a.v=b}function z(a){var b={};for(var c=0;c<a.v.length;c++)b[a.v[c].id]=a.v[c].v;a.v=b}function A(a){var b,c,d,e,f=0;for(var g in a){var h=a[g];b=b?Math.min(b,h.x-h.size):h.x-h.size,c=c?Math.min(c,h.y-h.size):h.y-h.size,d=d?Math.max(d,h.x+h.size):h.x+h.size,e=e?Math.max(e,h.y+h.size):h.y+h.size,f++}return{x1:b,y1:c,x2:d,y2:e,c:f}}function B(a,b){return C(a.x-b.x,a.y-b.y)}function C(a,b){return Math.max(1e-4,Math.sqrt(a*a+b*b))}function D(a,b,c){function e(a,b){d.push({id:a+"",level:b})}var d=[];for(var f=0;f<c.length;f++){var g=c[f];e(g,0);while(d.length>0){var h=d.shift(),i=a[h.id].hasOwnProperty("level")?a[h.id].level>=h.level:!0;if(i){a[h.id].level=h.level;for(var j=0;j<b.length;j++)b[j].id1===h.id&&(b[j].level=h.level,e(b[j].id2,h.level+1)),b[j].id2===h.id&&(b[j].level=h.level,e(b[j].id1,h.level+1))}}}}function E(a,b){function d(a,b,d,e){c[a]=c[a]||[],c[a][b]=c[a][b]||{},c[a][b][d]=c[a][b][d]||[],c[a][b][d].push(e)}var c={};for(var e in a)a[e].hasOwnProperty("level")&&d(a[e].c,a[e].level,"vertices",e);for(var f=0;f<b.length;f++)b[f].hasOwnProperty("level")&&d(b[f].c,b[f].level,"edges",b[f]);return c}function F(a,b,c,d){for(var e in a)a[e].hasOwnProperty("level")&&(c[e].t=a[e].level);for(var f=0;f<b.length;f++)b[f].hasOwnProperty("level")&&(d[b[f].id].t=b[f].level)}function G(a,b){var c=[];for(var d=0;d<a.length;d++)b[a[d]]&&c.push(a[d]);return c}function H(a){var b=Number(a);return b=isNaN(b)?5:b,b=Math.max(0,b),b=Math.min(10,b),b}function I(a){return(5-H(a))*10}function J(a,c,d,e,f,g){function y(a,b){return h[a].x<h[b].x}function z(a,b){var c=[],d=p[a][b].vertices;for(var e=0;e<d.length;e++)c.push(p[a][b].vertices[e]);return c.sort(y),c}function A(a,b,c){p[a][b].ordered=c}function B(a,b){for(var c=0;c<a.length;c++)if(a[c]===b)return c;return-1}function C(a,b,c){var d=-1;for(var e=0;e<b.length;e++){if(b[e].id1===c){d=B(a,b[e].id2);if(d>-1)return d}if(b[e].id2===c){d=B(a,b[e].id1);if(d>-1)return d}}throw"bad index"}function F(a,b,c,d,e,f){var g=p[a][b].edges,h=f,i=C(c,g,e),j=0;for(var k=0;k<d.length;k++){var l=C(c,g,d[k]);(i<l&&h>k||i>l&&h<=k)&&j++}return j}function N(a,b,c){var d=[],e;for(var f=0;f<b.length;f++)b[f].id1===c&&(e=B(a,b[f].id2),e>-1&&d.push(e)),b[f].id2===c&&(e=B(a,b[f].id1),e>-1&&d.push(e));return d}function O(a){var b=a.length;return b===0?-1:(a[b-1]+a[0])/2}function P(a,b,c){function i(a,b){var c=d[a].v-d[b].v;return c===0&&(c=-(d[a].c-d[b].c),c===0&&(c=d[a].i-d[b].i)),c}var d={},e=[];for(var f=0;f<b.length;f++){var g=N(a,c,b[f]),h=O(g);d[b[f]]={v:h,c:g.length,i:f},e.push(b[f])}return e.sort(i),e}function Q(){for(var a in p){var b=p[a];for(var c=b.length-1;c>=1;c--){var d=b[c].edges,e=b[c].ordered,f=b[c-1].ordered,g=P(e,f,d);b[c-1].ordered=g}}}function R(){for(var a in p){var b=p[a];for(var c=0;c<b.length-1;c++){var d=b[c+1].edges,e=b[c].ordered,f=b[c+1].ordered,g=P(e,f,d);b[c+1].ordered=g}}}function T(){var a=0,b=0,c,d;for(d in p)for(var e=p[d].length-1;e>=0;e--){var f=p[d][e].ordered,g=[];for(var i=0;i<f.length;i++){var j=K(p,h,f[i]);h[f[i]].children=[],h[f[i]].subChildrenCount=0;if(j.length===0)a++;else{var k=[];for(c=0;c<j.length;c++)B(g,j[c])<0&&k.push(j[c]);if(k.length>0){h[f[i]].children=k,h[f[i]].subChildrenCount=V(k);for(c=0;c<k.length;c++)g.push(k[c]),h[k[c]].parent=f[i]}}b++}}}function V(a){var b=0;for(var c=0;c<a.length;c++){var d=h[a[c]].subChildrenCount;b+=d===0?1:d}return b}function Y(a,b,c){c||(a.x=b);var d=b-a.subChildrenCount*X/2,e=a.children;if(e)for(var f=0;f<e.length;f++){var g=h[e[f]],i=g.subChildrenCount;i===0&&(i=1);var j=d+i*X;Y(g,(j+d)/2,!1),d=j}}function Z(a,b){for(var c=0;c<p[a].length;c++){var d=p[a][c].ordered;for(var e=0;e<d.length;e++){var f=h[d[e]];f.y=b.miny+c*(t+12)*2}}}function $(a,b){var c={up:function(a){a.y=-a.y,a.x=-a.x},down:function(a){},right:function(a){var b=a.y;a.y=-a.x,a.x=b},left:function(a){var b=a.y;a.y=a.x,a.x=-b}},d=c[b]||c.down;for(var e=0;e<p[a].length;e++){var f=p[a][e].ordered;for(var g=0;g<f.length;g++)d(h[f[g]])}}var h=c.v,i=c.e,j=w(h,i),k=c.extents;d=b.defaults(d,{top:[],orientation:"down"});var l=g?1:I(d.tightness),m=j.length,n=d.top;n=G(n,h);var o=d.tidy;D(h,i,n);var p=E(h,i),q=0,r=0,s=26,t=0,u=0,v=0;for(var x in h)h[x].level===0&&(u+=1,q+=h[x].x,r+=h[x].y),h[x].hasOwnProperty("level")&&(s=Math.max(s,h[x].size),t+=h[x].size,v+=1);q/=u,r/=u,t/=v;for(var H in p){var J=z(H,0);A(H,0,J);for(var L=1;L<p[H].length;L++){var M=z(H,L);A(H,L,M)}}var S=3;while(S>0)Q(),R(),S--;T();var X=2*t+24+l,_={};for(H in p){var ba=bc(j[Number(H)].verts);_[Number(H)]=ba;var bb={children:p[H][0].ordered,subChildrenCount:V(p[H][0].ordered)};Y(bb,ba.x,!0),Z(H,ba),g||$(H,d.orientation)}g&&g(h,p,j,_,t,d.tightness);var bd=[];o?U(a,h,j,0,1,k,bd,d,e,f):W(a,h,k,bd,d,e,f)}function K(a,b,c){var d=b[c].c,e=b[c].level+1,f=a[d][e],g={},h=[];if(f){for(var i=0;i<f.edges.length;i++){var j=f.edges[i];j.id1===c&&(g[j.id2]=1),j.id2===c&&(g[j.id1]=1)}var k=f.ordered;for(var l=0;l<k.length;l++)g[k[l]]&&h.push(k[l])}return h}function L(a,b,c){return K(a,b,c).length>0}function M(a,c){var d={};for(var e=0;c&&e<c.length;e++){var f=c[e];b.contains(a,f.id1)&&!b.contains(a,f.id2)&&(d[f.id1]||(d[f.id1]={p:[]}),d[f.id1].p.push(f.id2)),b.contains(a,f.id2)>=0&&!b.contains(a,f.id1)&&(d[f.id2]||(d[f.id2]={p:[]}),d[f.id2].p.push(f.id1))}return d}function N(a,b,c,d,e,f){function g(a,b){return(a.r+b.r)/(a.a-b.a)}function h(a,b,c){var d=b>0?a+c:a+c/2;return d>0?d:a}function i(a,b,c,d){if(d&&a.length===1)return 0;var e=b,f=e;for(j=1;j<a.length;j++)f=Math.max(g(l[a[j]],l[a[j-1]]),f);return h(f,f-e,c)}var j,k,l;f=I(f);for(var m in b){var n=bc(c[Number(m)].verts),o=0,p=o,q=4*e,r=q,s=2*e+24;for(k=0;k<b[m].length;k++){var t=b[m][k].ordered,u;l=[];for(j=0;j<t.length;j++){u=a[t[j]];var v=u.x-n.minx,w=k===0?k+1:k,x=n.maxx-n.minx+s;v=2*Math.PI*v/x;if(v<0||v>2*Math.PI)throw new Error("[Radial] Theta angle should be in the range [0; 2*PI]");l[t[j]]={a:v,r:u.size}}p=o,k===0?t.length>1&&(o+=q/2):o+=q,o=i(t,o,f,k<1),o-p>r&&(r=o-p+1,q=Math.max(q,r/2),k===0&&t.length<3&&(o/=2));var y={},z=[];for(j=0;j<t.length;j++){var A=P(a,t[j]);A?(y[A]=y[A]||{parent:A,list:[]},y[A].list.push(t[j])):z.push(t[j])}var B=d[Number(m)];for(j=0;j<z.length;j++)O([z[j]],l,o,B,s,a);for(var C in y)O(y[C].list,l,o,B,s,a)}}}function O(a,b,c,d,e,f){var g=0,h,i,j;for(h=0;h<a.length;h++)g+=b[a[h]].a;g/=a.length,i=c>0?e/c:0,j=g-i*(a.length-1)/2;for(h=0;h<a.length;h++){var k=f[a[h]];k.x=d.x+c*Math.cos(j),k.y=d.y+c*Math.sin(j),k.theta=j,j+=i}}function P(a,b){var c=a[b].parent;return c&&a[c].parent?a[b].children.length===0?c:null:null}function Q(a,b){var c=a.extents.c,d=Math.max(a.extents.x2-a.extents.x1,a.extents.y2-a.extents.y1),e=Math.sqrt(c)*120,f=Math.max(d,e)/2,g=0;c>1&&(g=Math.min(Math.pow(c,2.5),100));var h=g*c*Math.log(c),i=1/R(b);return{repulsionFactor:40*Math.max(1,Math.pow(i,2)),coeff:1,naturalDistance:20*i,iterations:g,chunk:20,temperature:f,temp:f,estTime:h}}function R(a){var b=H(a.tightness);return Math.pow(2,(b-5)*2/5)}function S(a,b,c,d,e){function x(b){var c=i[b],d=q[b];Z(a,c,d,d.start,d.stop,function(){_(c.verts),b++,b<i.length?x(b):y()})}function y(){l?U(a,f,i,p,1,j,k,c,d,e):W(a,f,j,k,c,d,e)}var f=b.v,g=b.vcount,h=b.e,i=w(f,h),j=b.extents,k=c.fixed||[],l=c.tidy;ba(f);var m=i.length,n=g/(g+m),o=0,p=l?n:1;a.trigger("progress","layout",0);var q=[],r=0;for(var s=0;s<i.length;s++){var t=Q(i[s],c);r+=t.estTime,q.push(t)}var u=0;for(s=0;s<i.length;s++){q[s].start=u;var v=u+(p-o)*q[s].estTime/r;q[s].stop=v,u=v}i.length>0?x(0):W(a,f,j,k,c,d,e)}function T(a){for(var b in a)if(a[b].fixed)return!0;return!1}function U(a,b,c,d,e,f,g,h,i,j){var k={},l=[],m={};for(var n=0;n<c.length;n++){var o=bd(c[n].verts);k[n]=o;var p=T(c[n].verts);l.push({x:o.x,y:o.y,width:o.width,height:o.height,id:n,fixed:p}),m[n]={x:o.x,y:o.y}}var q=bi(l,{strategy:h.strategy,step:30,max:2,sort:!1,ratio:h.ratio,tightness:h.tightness}).comps,r={};for(var s=0;s<q.length;s++)r[q[s].id]=q[s];for(var t in b){var u=b[t];if(!k[u.c].fixed){var v=r[u.c].x-m[u.c].x,w=r[u.c].y-m[u.c].y;u.x+=v,u.y+=w}}W(a,b,f,g,h,i,j)}function W(a,b,c,d,e,f,g){var h=A(b);d.length===0&&(h=$(b,c,h)),isNaN(h.x1)&&(h=null),a.trigger("progress","layout",1),g({vertices:b,extents:h},e,f)}function X(a,b,c){var d=a[b.id1],e=a[b.id2];if(d.fixed&&e.fixed)return;var f=Math.random()*2*Math.PI,g=(d.x+e.x)/2,h=(d.y+e.y)/2,i=be(d,e,c)*1.3/2;d.x=g+i*Math.cos(f),d.y=h+i*Math.sin(f),f+=Math.PI,e.x=g+i*Math.cos(f),e.y=h+i*Math.sin(f)}function Y(a,b,c){var d=Math.min(a.i+c.chunk,c.iterations);while(a.i<d){var e=b.verts,f=b.edges,g=0;for(var h in e)e[h].dx=e[h].dy=0,g++;if(g===1){a.i=d;return}if(g===2){X(e,f[0],c.naturalDistance),a.i=d;return}bh(e,c.repulsionFactor);for(var i=0;i<f.length;i++)bf(f[i],e,c.naturalDistance,c.coeff);var j=a.temperature*(1-a.i/c.iterations);for(var k in e)bg(e[k],j);a.i++}}function Z(a,b,c,d,e,f){function h(){return d+(e-d)*g.i/c.iterations}function i(){return g.i>=c.iterations}function j(){Y(g,b,c)}function k(){j(),i()?f():(a.trigger("progress","layout",h()),setTimeout(k,0))}var g={i:0,temperature:c.temperature};k()}function $(a,b,c){var d=(c.x1+c.x2)/2-(b.x1+b.x2)/2,e=(c.y1+c.y2)/2-(b.y1+b.y2)/2;for(var f in a)a[f].x-=d,a[f].y-=e;return{x1:c.x1-d,y1:c.y1-e,x2:c.x2-d,y2:c.y2-e}}function _(a){var b=0,c=0,d=0,e=!1,f=0,g=0,h,i,j;for(var k in a)b+=a[k].x,c+=a[k].y,d+=1,e|=a[k].fixed;if(d<3||e)return;b/=d,c/=d;for(k in a)h=Math.sqrt((a[k].x-b)*(a[k].x-b)+(a[k].y-c)*(a[k].y-c)),h>g&&(g=h,f=Math.atan2(a[k].y-c,a[k].x-b));f=-f;for(k in a)i=b+(a[k].x-b)*Math.cos(f)-(a[k].y-c)*Math.sin(f),j=c+(a[k].x-b)*Math.sin(f)+(a[k].y-c)*Math.cos(f),a[k].x=i,a[k].y=j}function ba(a){var b=30;for(var c in a)a[c].fixed||(a[c].x+=b*(Math.random()-.5),a[c].y+=b*(Math.random()-.5))}function bb(a){return typeof a!="undefined"}function bc(a){var b=0,c=0,d=0,e=Infinity,f=Infinity,g=-Infinity,h=-Infinity,i;for(i in a)b+=1,c+=a[i].x,d+=a[i].y,f=Math.min(f,a[i].x),e=Math.min(e,a[i].y),g=Math.max(g,a[i].x),h=Math.max(h,a[i].y);c/=b,d/=b;var j=0,k=!1;for(i in a){var l=a[i].x-c,m=a[i].y-d,n=Math.sqrt(l*l+m*m);j=Math.max(n+a[i].size*1.5,j),k=k||a[i].fixed}return{x:c,y:d,sum:b,size:j,fixed:k,miny:e,minx:f,maxy:h,maxx:g}}function bd(a,c){b.isNullOrUndefined(c)&&(c={});var d=20,e=Infinity,f=Infinity,g=-Infinity,h=-Infinity,i;for(i in a)i in c||(f=Math.min(f,a[i].x-a[i].size),e=Math.min(e,a[i].y-a[i].size),g=Math.max(g,a[i].x+a[i].size),h=Math.max(h,a[i].y+a[i].size));return f-=d,e-=d,g+=d,h+=d,{x:f,y:e,width:g-f,height:h-e}}function be(a,b,c){return a.size+b.size+c*(1+((a.lc?a.lc:1)+(b.lc?b.lc:1))/6)}function bf(a,b,c,d){var e=b[a.id1],f=b[a.id2],g=e.x-f.x,h=e.y-f.y,i=be(e,f,c),j=C(g,h);if(j>.02){var k=d*(j-i)/j,l=g*k,m=h*k;e.dx-=l,e.dy-=m,f.dx+=l,f.dy+=m}}function bg(a,b){if(!a.fixed){var c=C(a.dx,a.dy),d=a.dx/c*Math.min(c,b),e=a.dy/c*Math.min(c,b);a.x+=d,a.y+=e}}function bh(a,b){function j(a,b,c,d){return{leaf:!0,nodes:{},point:null,x1:a,y1:b,x2:c,y2:d}}function k(a,b){var c=a.x1,d=a.y1,e=a.x2,f=a.y2,g=(c+e)*.5,h=(d+f)*.5,i=b.x>=g,k=b.y>=h,m=(k<<1)+i;a.leaf=!1,i?c=g:e=g,k?d=h:f=h,a=a.nodes[m]||(a.nodes[m]=j(c,d,e,f)),l(a,b)}function l(a,b){if(a.leaf){var c=a.point;c?Math.abs(c.x-b.x)+Math.abs(c.y-b.y)<.01?k(a,b):(a.point=null,k(a,c),k(a,b)):a.point=b}else k(a,b)}function m(a,b){if(!a(b)){var c=b.nodes;for(var d=0;d<4;d++)c[d]&&m(a,c[d])}}function n(a){var b=0,c=0;a.charge=0,a.size=0;if(!a.leaf){var d=a.nodes;for(var e=0;e<4;e++){var f=d[e];f&&(n(f),a.charge+=f.charge,a.size+=f.size,b+=f.charge*f.cx,c+=f.charge*f.cy)}}if(a.point){var g=v(a.point);a.charge+=a.pointCharge=g,a.size+=a.point.size,b+=g*a.point.x,c+=g*a.point.y}a.cx=a.charge?b/a.charge:0,a.cy=a.charge?c/a.charge:0}function s(a){if(a.point!==p){var b=a.cx-p.x,c=a.cy-p.y,d=1/C(b,c);if((a.x2-a.x1)*d<o)return u(p,a,a.charge,d,b,c),r++,!0;a.point&&(u(p,a.point,a.pointCharge,d,b,c),q++)}return!a.charge}function u(a,b,c,d,e,f){d>t&&(d=t),w(a,c,e,f,d)}function v(a){return a.size*(1+(a.lc?a.lc:1)/3)}function w(a,c,d,e,f){if(f<.001)return;var g=b*v(a)*c*f*f*f;a.dx-=d*g,a.dy-=e*g}function z(){for(var b in a)p=a[b],m(s,x)}var c,d,e,f,g=bc(a);c=g.minx,e=g.miny,d=g.maxx,f=g.maxy;var h=d-c,i=f-e;h>i?f=e+h:d=c+i;var o=.5,p,q=0,r=0,t=1e5,x=j(c,e,d,f);for(var y in a)l(x,a[y]);return n(x),z(),x}function bk(a,b,c){var d=bl(),e;b.canvas||(b.canvas=bm());var f=b.canvas.setDimensions(b.width,b.height),g=0,h=0;for(var i=0;i<a.length;i++){var j=a[i];j.fixed&&!1?e=f.addRect(j.width,j.height,j):e=f.addRect(j.width,j.height);if(!e.placed){d.width=0,d.height=0,d.comps.length=0,d.lowestHeightFlushedRightItem=0;break}j.x=e.offsetX,j.y=e.offsetY,d.comps.push(j),j.y+j.height>d.height&&(d.height=j.y+j.height),j.x+j.width>d.width&&(d.width=j.x+j.width);var k=j.width+j.x;if(k>h||k===h&&j.height>g)d.lowestHeightFlushedRightItem=e.lfhd,g=j.height,h=k}return c.cellsGenerated=f.cells,c.addAttempts=f.addAttempts,b.lowestFreeHeightDeficit=f.lfhDeficitSinceLastRedim(),d}function bl(){var a={width:0,height:0,area:function(){return a.width*a.height},comps:[],lowestHeightFlushedRightItem:0,ratio:function(){return a.width===0?Infinity:a.width/a.height}};return a}function bm(){function d(a,b){var c=k.height-a;return b-c}function e(a,c,d){if(d.leftOverW>0){k.cells+=b.rows();var e=a+d.nRequiredCellsH-1;b.insertCol(e,d.leftOverW)}if(d.leftOverH>0){k.cells+=b.cols();var f=c+d.nRequiredCellsV-1;b.insertRow(f,d.leftOverH)}for(var g=a+d.nRequiredCellsH-1;g>=a;g--)for(var h=c+d.nRequiredCellsV-1;h>=c;h--)b.setItem(g,h,!0)}function f(a,c,d,e){e.nRequiredCellsH=0,e.nRequiredCellsV=0,e.leftOverW=0,e.leftOverH=0;var f=0,g=0,h=a,i=c;while(g<d.height){h=a,f=0;while(f<d.width){if(b.item(h,i))return!1;f+=b.colWidth(h),h++}g+=b.rowHeight(i),i++}return e.nRequiredCellsH=h-a,e.nRequiredCellsV=i-c,e.leftOverW=f-d.width,e.leftOverH=g-d.height,!0}function g(a,c,d){var e=0,f=0,g=0,h=0,i=0;for(g=0;g<a;g++)e+=b.colWidth(g);for(g=0;g<c;g++)f+=b.rowHeight(g);h=d.x-e,i=d.y-f;if(h<0||i<0)return!1;if(h>0){k.cells+=b.rows();var j=b.colWidth(a)-h;b.insertCol(a,j)}if(i>0){k.cells+=b.cols();var l=b.rowHeight(c)-i;b.insertRow(c,l)}return!0}function h(a,c){return k.width=a,k.height=c,k.area=j(),b.init(a,c,!1),k}function i(a,h,i){var j={offsetX:0,offsetY:0,width:a,height:h,placed:!1},l=0,m=0,n=0,o=0,p={};if(i){while(l<b.cols()&&n<i.x)n+=b.colWidth(l),l++;while(m<b.rows()&&o<i.y)o+=b.rowHeight(m),m++;g(l-1,m-1,i),n-=b.colWidth(l),o-=b.rowHeight(m)}k.addAttempts++;var q=bo;for(;;){p={};while(m<b.rows()&&b.item(l,m))o+=b.rowHeight(m),m++;if(m<b.rows()&&d(o,j.height)<=0){if(f(l,m,j,p)){e(l,m,p),j.offsetX=n,j.offsetY=o,j.placed=!0;break}o+=b.rowHeight(m),m++}var r=d(o,j.height);r>0&&(o=0,m=0,n+=b.colWidth(l),l++,k.lfhDeficitSinceLastRedim()>r&&(c=r));if(k.width-n<j.width){j.placed=!1;break}}return q=c,{offsetX:j.offsetX,offsetY:j.offsetY,lfhd:q,placed:j.placed}}function j(){return k.width*k.height}var a=0,b=bn(),c=bo,k={matrix:b,cells:a,addAttempts:0,addRect:i,lfhDeficitSinceLastRedim:function(){return c},setDimensions:h};return k}function bn(){function g(){if(a.length>0||c.length>0)a.length=0,c.length=0,d.length=0}function h(b,h,i){if(b>0){if(h>0)return e=1,f=1,g(),a.push({index:0,size:b}),c.push({index:0,size:h}),d[0]=[],d[0][0]=i,l;throw"[Matrix] Row size cannot be 0 or similar"}throw"[Matrix] Column size cannot be 0 or similar"}function i(a,b){var g=c[a].index;for(var h=0;h<f;h++)d[h][e]=d[h][g];return a<e-1&&c.splice(a+1,0,{index:e,size:b}),c[a+1]={index:e,size:b},c[a].size-=b,e++,l}function j(c,e){var g=d[0].length,h=a[c].index;return d[f]=b.clone(d[h]),c<f-1&&a.splice(c+1,0,{index:f,size:e}),a[c+1]={index:f,size:e},a[c].size-=e,f++,l}function k(){var b="\n     ",d,g,h,i=0,j=0;for(i=0;i<f;i++)d=Math.floor(a[i].size/100)%10===0?" ":""+Math.floor(a[i].size/100)%10,g=Math.floor(a[i].size/10)%10===0&&d===" "?" ":""+Math.floor(a[i].size/10)%10,h=Math.floor(a[i].size)%10===0&&d===" "&&g===" "?" ":""+Math.floor(a[i].size)%10,b+=a[i].size>999?" "+a[i].size+" ":" "+d+""+g+""+h+" ";b+="\n";for(i=0;i<e;i++){d=Math.floor(c[i].size/100)%10===0?" ":""+Math.floor(c[i].size/100)%10,g=Math.floor(c[i].size/10)%10===0&&d===" "?" ":""+Math.floor(c[i].size/10)%10,h=Math.floor(c[i].size)%10===0&&d===" "&&g===" "?" ":""+Math.floor(c[i].size)%10,b+=c[i].size>999?" "+c[i].size+": ":" "+d+""+g+""+h+": ";for(j=0;j<f;j++)b+=l.item(j,i)?"  X  ":"  .  ";b+="\n"}return b}var a=[],c=[],d=[],e=0,f=0,l={init:h,cols:function(){return f},rows:function(){return e},item:function(b,e){return d[a[b].index][c[e].index]},setItem:function(b,e,f){d[a[b].index][c[e].index]=f},insertRow:i,insertCol:j,colWidth:function(b){return a[b].size},rowHeight:function(a){return c[a].size},inspect:k};return l}var a;typeof KeyLinesExports!="undefined"?a=exports:(this.KeyLines=this.KeyLines||{},a=this.KeyLines.Layouts={});var b=typeof KeyLinesRequire!="undefined"?require("./util"):this.KeyLines.Util,n=40,o=a.resetConnectionOffsets=function(a,b){function c(a,b){return a[0].link.id1===b[0].link.id1&&a[0].link.id2===b[0].link.id2||a[0].link.id2===b[0].link.id1&&a[0].link.id1===b[0].link.id2}var d=r(a),e=r(b),f={};for(var g=0;g<e.length;g++)for(var h=0;h<d.length;h++)if(c(d[h],e[g])){f[h]=1;break}q(d,f)},p=a.resetAllConnectionOffsets=function(a){var b=r(a),c={};for(var d=0;d<b.length;d++)c[d]=1;q(b,c)};a.setUpUninitializedConnections=function(a){var b=r(a),c={};for(var d=0;d<b.length;d++){var e=!1,f=b[d];if(f.length>1){for(var g=0;g<f.length;g++)f[g].link&&(e=e||typeof f[g].link.off!="undefined");e||(c[d]=1)}}q(b,c)};var r=a.connectionMaker=function(a){var b=[],c={},d,e;for(var f in a){var g=a[f];if(!g.hi){var h={id:f,link:g};d=g.id1<g.id2?g.id1:g.id2,e=g.id1<g.id2?g.id2:g.id1,c[d]||(c[d]={}),c[d][e]||(c[d][e]=[]),c[d][e].push(h)}}for(d in c)for(var i in c[d])b.push(c[d][i]);return b},x=a.extractStructure=function(a,b,c,d,e,f){var g=null;if(e){g={};for(var h=0;h<e.length;h++)g[e[h]]=1}var i=v(a,b,c,d,g,f);return i.extents=A(i.v),y(i),i};a.layout=function(a,b,c,e,f,g){b.trigger("prechange","layout"),z(c);if(!/^(standard|hierarchy|radial|structural)$/.test(a))throw new Error('The layout type given is not valid: choose from either "standard", "structural", "hierarchy" or "radial"');a==="standard"&&S(b,c,e,f,g),a==="hierarchy"&&J(b,c,e,f,g),a==="structural"&&d(b,c,e,f,g),a==="radial"&&J(b,c,e,f,g,N)};var V=function(a,b){return{x1:Math.min(a.x1,b.x1),y1:Math.min(a.y1,b.y1),x2:Math.max(a.x2,b.x2),y2:Math.max(a.y2,b.y2)}};a.arrange=function(a,c,d,e,f,g){function h(a,b){var c,d=[];for(c=0;c<b.length;c++)a[b[c]]&&d.push(b[c]);return d}function i(a,b,c,d){var e;for(e=0;e<a.length;e++)if(a[e].id===b){a[e].x=c-a[e].width/2,a[e].y=d-a[e].height/2;break}return a}function o(a,b,c,d){var e={},g=[],h={};for(q=0;q<a.length;q++)h=bd(a[q].verts,b),isFinite(h.width)&&(g.push({x:h.x,y:h.y,width:h.width,height:h.height,id:q}),e[q]={x:h.x,y:h.y});h=bd(b),g.push({x:h.x,y:h.y,width:h.width,height:h.height,id:n}),e[n]={x:h.x,y:h.y};var i=v(g,{ratio:f.ratio,centre:c,absolute:d,specialId:n});return{packed:i,original:e}}function p(a,b,c){var d,e;for(var f in a){var g=a[f];g.arranged?(d=c[n].x-b[n].x,e=c[n].y-b[n].y):(d=c[g.c].x-b[g.c].x,e=c[g.c].y-b[g.c].y),g.x+=d,g.y+=e}}var j={tidy:function(a,b){return bj(a,{step:30,max:2,sort:!1,ratio:b.ratio}).comps},average:function(a,b){return i(a,b.specialId,b.centre.x,b.centre.y)},absolute:function(a,b){return i(a,b.specialId,b.absolute.x,b.absolute.y)}},l={grid:function(a,b,c,d){var e=2*c+24+d,f=0,g=0,h=Math.floor(Math.sqrt(a.length)),i=Math.ceil(a.length/h),j={};for(q=0;q<h;q++){for(r=0;r<i;r++){var k=i*q+r;a[k]&&(j[a[k]]={x:f,y:g}),f+=e}f=0,g+=e}return j},circle:function(a,b,c,d){var e=1.25-(d-5)/50;return m(b,a,c,e).positions},radial:function(a,b,c,d){var e=1.25-(d-5)/50;return k(b,a,c,e).positions}},n="#arranged#",q,r,s;f=b.defaults(f,{tightness:5,position:"average",x:0,y:0}),c.trigger("prechange","arrange"),z(e);var t=e.v,u=I(f.tightness),v=j[f.position]||j.average,x=l[a]||l.grid,y={x:Number(f.x)||0,y:Number(f.y)||0},A={x:0,y:0};d=h(t,d);if(!d.length)return;s=0;for(q=0;q<d.length;q++)s+=t[d[q]].size,A.x+=t[d[q]].x,A.y+=t[d[q]].y;s/=d.length,A.x/=d.length,A.y/=d.length;var B=x(d,t,s,u),C={};for(var D in B)t[D].x=B[D].x,t[D].y=B[D].y,C[D]=t[D],C[D].arranged=1;var E=w(t,e.e),F=o(E,C,A,y),G=F.packed,H=F.original,J={};for(q=0;q<G.length;q++)J[G[q].id]=G[q];p(t,H,J);var K=[],L=e.extents;W(c,t,L,K,f,!1,g)};var bi=function(a,c){function d(){return Math.random()*2-1+(Math.random()*2-1)+(Math.random()*2-1)}function e(a,b,c){return(b-a)*c+a}function f(a,b,c){return(a-c)/(b-c)}function g(a){var b=function(){var b=0,c=-Infinity;for(var d=0;d<a.length;d++)b+=a[d].width*a[d].height,c=Math.max(c,a[d].width);return{area:b,maxWidth:c}},d=1.1,e=1.03,f=10,g=b(),h=Math.sqrt(g.area*d/c.ratio)*e,i=h*c.ratio,j=0;return i<g.maxWidth+f&&(i=g.maxWidth+f),{x:0,y:0,width:i,height:h}}function h(a,b,c,d,g,h){var i=f(b,c,d);return i=Math.pow(i,a),e(h,g,i)}function i(a,b){if(!b)return!1;var c=a.x<r.x+r.width,d=a.x+a.width>r.x,e=a.y<r.y+r.height,f=a.y+a.height>r.y;return c||d&&e||f}function j(a,b){function c(a,b){var c=a.y<b.y+b.height,d=a.y+a.height>b.y;return c&&d}function d(a,b){var c=a.x<b.x+b.width,d=a.x+a.width>b.x;return c&&d}if(b.length<1)return!1;var e,f;for(e=0;e<b.length;e++){f=b[e];if(d(a,f)&&c(a,f))return!0}return!1}function k(a,b){return a.fixed&&!b.fixed?-1:b.fixed&&!a.fixed?1:0}var l={spiral:function(a){var b=h(.6,a,100,0,u,1),c=h(1,a,600,0,.3,.5),d=c*a,e=Math.cos(d)*b,f=Math.sin(d)*b;return{x:e,y:f}},controlled:function(a,b){var c;while(!i(b,c))c=l.random(a);return c},rect:function(a){return bj(a,c)},random:function(a){var b=a*.5;return{x:d()*b,y:d()*b}}};c=b.defaults(c,{strategy:"rect",ratio:4/3});var m,n,o,p,q=0,r=g(a),s=[],t=l[c.strategy]||l.rect,u=0;for(m=0;m<a.length;m++)n=a[m],u+=n.width;u/=2*a.length;if(c.strategy.match(/^rect$/))return t(a);a.sort(k);for(m=0;m<a.length;m++){n=a[m],n.x=n.fixed?n.x:0,n.y=n.fixed?n.y:0;while(j(n,s)&&!n.fixed)p=t(q,n),n.x=p.x,n.y=p.y,q++;s.push(n)}return{comps:s,stats:{cellsGenerated:q,addAttempts:q}}},bj=a.pack=function(a,c){function d(){var b=0;for(var c=0;c<a.length;c++)b+=a[c].width*a[c].height;return b}function e(a,b){var c=f(a,b);return c?c:a.height>b.height?-1:a.height<b.height?1:0}function f(a,b){return a.fixed&&!b.fixed?-1:b.fixed&&!a.fixed?1:0}function g(a){var b=0;for(var c=0;c<a.length;c++)b<a[c].width&&(b=a[c].width);return b}function h(a){var d=b.clone(a);for(var e=0;e<d.length;e++){var f=d[e].width%c.step,g=d[e].height%c.step;f!==0&&(d[e].width=d[e].width+(c.step-f)),g!==0&&(d[e].height=d[e].height+(c.step-g))}return d}function i(a,b){var c={isBigger:function(){return s.width*s.height>a},isSmallerThanAll:function(){return s.width*s.height<b},isFeasable:function(){return!c.isBigger()&&!c.isSmallerThanAll()}};return c}function j(a){return o?a.ratio()>=c.ratio-.2&&a.ratio()<=c.ratio:!0}function k(a,b){var c;for(var d=0;d<a.length;d++)b(c,a[d])&&(c=a[d]);return c}function l(a){var b=I(c.tightness);for(var d=0;d<a.length;d++)a[d].width+=b,a[d].height+=b}function m(a,b){var d=1.1,e=1.03,f=10,g=Math.sqrt(a.area()*d/c.ratio)*e,h=g*c.ratio,i=0;return h<a.maxWidth+f&&(h=a.maxWidth+f),{width:h,height:g,lowestFreeHeightDeficit:0,ratio:function(){return s.width/s.height}}}c=b.defaults(c,{ratio:4/3,max:10,sort:!0,step:10,tightness:5}),c.sort&&a.sort(e),l(a);var n=h(a),o=!0,p={candidatesFailure:0,candidatesOk:0,addAttempts:0,cellsGenerated:0,candidatesAccepted:0,totalTime:0},q;if(a.length===0)return q=bl(),q.stats=p,q;var r={area:d,maxWidth:g(n),maxHeight:n[0].height},s=m(r,n),t=(new Date).getTime();while(s.width>=r.maxWidth){var u=bk(n,s,p);if(u.comps.length===0)p.candidatesFailure++,s.width*=1.03,s.height*=1.03;else{p.candidatesOk++;if(!q||j(u)){p.candidatesAccepted++,q=u,q.efficiency=r.area()/u.area();if(j(u))break}if(p.candidatesOk>=c.max)break}}var v=(new Date).getTime();return p.totalTime=Math.floor(v-t),q.stats=p,q},bo=16e6})();

